version: 2.1
orbs:
  welcome: circleci/welcome-orb@0.4.1

commands:
  wait_for_dpkg:
    description: "Wait for packaging operations to finish"
    steps:
    - run:
        name: "Wait for packaging operations to finish"
        command: |
          sleep 10
          while systemctl status apt-daily >/dev/null || systemctl status apt-daily-upgrade >/dev/null || sudo fuser /var/{lib/{dpkg,apt/lists},cache/apt/archives}/lock; do
          echo "waiting 30s for dpkg locks..."
          sleep 30
          done
jobs:
  start_minnaker:
    machine:
      image: circleci/classic:201808-01
    steps:
      - run:
          name: Install kind
          command: |
            curl -Lo ./kind https://github.com/kubernetes-sigs/kind/releases/download/v0.7.0/kind-$(uname)-amd64
            chmod +x ./kind
            ./kind create cluster
            ./kind get nodes

workflows:
  test:
    jobs:
      - start_minnaker

